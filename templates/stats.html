{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/stats.css') }}">
<div class="stats-container">

    <h2>商品銷售統計</h2>

    <!-- 新增：營業額 + 毛利 -->
    <div class="summary-box">
        <p><strong>總營業額：</strong> <span id="totalRevenue">0</span> 元</p>
    </div>

    <!-- 開關：包含未完成訂單 -->
    <label>
        <input type="checkbox" id="includePending"> 包含未完成訂單
    </label>
    <br>

    <!-- 清理訂單選擇 -->
    <label for="clearType">選擇要刪除的訂單類型：</label>
    <select id="clearType">
        <option value="completed">完成訂單</option>
        <option value="pending">未完成訂單</option>
        <option value="missing">缺失 status 訂單</option>
    </select>
    <button id="clearOrdersBtn">清理訂單</button>
    <p id="clearResult"></p>

    <!-- 日期篩選 -->
    <label for="startDate">開始日期：</label>
    <input type="date" id="startDate">
    <label for="endDate">結束日期：</label>
    <input type="date" id="endDate">
    <button id="filterDateBtn">篩選</button><br>


    <!-- 圖表切換按鈕 -->
    <div class="chart-switch">
        <button id="barByProductBtn">長條圖(依商品累計)</button>
        <button id="barByDateBtn">長條圖(依日期群組)</button>
        <button onclick="showChart('line')">折線圖</button>
        <button onclick="showChart('pie')">圓餅圖</button>
        <button onclick="exportCSV()">下載 CSV</button>
    </div>


    <!-- 圖表容器 -->
    <div class="chart-box">
        <canvas id="barChart"></canvas>
        <canvas id="lineChart" style="display:none;"></canvas>
        <canvas id="pieChart" style="display:none;"></canvas>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script defer src="{{ url_for('static', filename='js/stats.js') }}"></script>
{% endblock %}
