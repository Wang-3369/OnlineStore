{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
<div class="profile-container">
    <h2>個人資料</h2>

    <div class="avatar-section">
        <img src="{% if session.get('avatar') %}/api/profile/avatar/{{ session['avatar'] }}{% else %}{{ session.get('google_avatar') or url_for('static', filename='images/user.png') }}{% endif %}" 
             alt="avatar" 
             style="width:100px; height:100px; border-radius:50%; object-fit: cover; border: 3px solid #e2e8f0;" 
             id="avatar-img">
        
        <div class="user-info">
            <p style="font-size: 1.1em; font-weight: bold; margin-bottom: 5px;">{{ user.username }}</p>
            <div class="btn-group">
                <label for="avatar-input" class="btn" style="padding: 8px 16px; font-size: 0.9em;">更換頭像</label>
                <input type="file" id="avatar-input" accept="image/*" style="display:none;">
                <button id="delete-avatar" class="btn-danger" style="padding: 8px 16px; font-size: 0.9em;">刪除頭像</button>
            </div>
        </div>
    </div>

    <h3 class="profile-section-title">基本資料</h3>
    <div class="email-section" style="margin-bottom: 25px;">
        <p style="font-size: 0.9em; color: #718096; margin-bottom: 8px;">
            目前 Email: <span id="current-email" style="color: #2d3748; font-weight: 600;">{{ user.email or "未設定" }}</span>
        </p>
        
        <div style="display: flex; gap: 10px;">
            <input type="email" id="new-email" class="profile-input" placeholder="輸入新 Email" style="flex: 1; margin-bottom: 0;">
            <button id="change-email" class="btn-secondary" style="white-space: nowrap; padding: 0 15px;">更新 Email</button>
        </div>
    </div>

    <hr style="border: 0; border-top: 1px solid #edf2f7; margin: 20px 0;">

    <h3 class="profile-section-title">安全性設定</h3>
    
    <label for="old-password" style="font-size: 0.9em; color: #718096; margin-bottom: 5px; display:block;">舊密碼</label>
    <input type="password" id="old-password" class="profile-input" placeholder="請輸入舊密碼">
    
    <label for="new-password" style="font-size: 0.9em; color: #718096; margin-bottom: 5px; display:block;">新密碼</label>
    <input type="password" id="new-password" class="profile-input" placeholder="請輸入新密碼">
    
    <button id="change-password" style="width: 100%; margin-top: 10px;">確認修改密碼</button>
</div>

<div id="crop-modal">
    <div class="crop-container">
        <img id="image-to-crop" src="" alt="Picture">
    </div>
    <div class="crop-actions">
        <button id="crop-upload-btn" class="btn-success">確認裁切並上傳</button>
        <button id="crop-cancel-btn" class="btn-secondary">取消</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script defer src="{{ url_for('static', filename='js/profile.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
{% endblock %}