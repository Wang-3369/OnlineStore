{% extends "base.html" %}
{% block content %}
<h2>個人資料</h2>

<p>使用者名稱：{{ user.username }}</p>

<!-- 頭像 -->
<img src="{{ user.avatar or url_for('static', filename='images/user.png') }}" 
     alt="avatar" style="width:100px;border-radius:50%;">
<input type="file" id="avatar-input">
<button id="upload-avatar">上傳頭像</button>

<!-- 修改密碼 -->
<h3>修改密碼</h3>
<input type="password" id="old-password" placeholder="舊密碼">
<input type="password" id="new-password" placeholder="新密碼">
<button id="change-password">修改密碼</button>

<script>
document.getElementById("upload-avatar").onclick = async () => {
    const file = document.getElementById("avatar-input").files[0];
    if (!file) return alert("請選擇檔案");

    const form = new FormData();
    form.append("avatar", file);

    const res = await fetch("/api/profile/avatar", { method:"POST", body: form });
    const data = await res.json();
    alert(data.message);
    if(res.ok) location.reload();
};

document.getElementById("change-password").onclick = async () => {
    const old_pw = document.getElementById("old-password").value;
    const new_pw = document.getElementById("new-password").value;

    const res = await fetch("/api/profile/change_password", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({old_password: old_pw, new_password: new_pw})
    });
    const data = await res.json();
    alert(data.message);
};
</script>
{% endblock %}
