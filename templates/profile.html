{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">

<style>
    /* ===== 新增：個人資料頁面專用樣式 ===== */
    .profile-container {
        max-width: 600px;       /* 限制最大寬度，避免太寬 */
        margin: 0 auto;         /* 居中 */
        background: #fff;       /* 白底 */
        padding: 40px;          /* 內距 */
        border-radius: 20px;    /* 圓角 */
        box-shadow: 0 10px 50px rgba(0, 0, 0, 0.1); /* 陰影 */
        text-align: left;       /* 內容靠左 */
    }

    /* 調整輸入框樣式，讓它跟文字大小一致 */
    .profile-input {
        width: 100%;
        padding: 10px 15px;     /* 縮小內距，讓框框不要太肥 */
        font-size: 16px;        /* 設定適當字體大小 */
        height: 45px;           /* 固定高度，讓視覺整齊 */
        margin-bottom: 15px;    /* 欄位間距 */
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        box-sizing: border-box; /* 確保 padding 不會撐大寬度 */
    }

    .profile-section-title {
        margin-top: 30px;
        margin-bottom: 15px;
        font-size: 1.2em;
        color: #2d3748;
        border-bottom: 2px solid #edf2f7;
        padding-bottom: 10px;
    }

    .avatar-section {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
    }

    .btn-group {
        display: flex;
        gap: 10px;
    }

    /* ===== Cropper 相關樣式 ===== */
    #crop-modal {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }
    
    .crop-container {
        max-width: 90%;
        max-height: 80%;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        overflow: hidden;
    }

    #image-to-crop {
        display: block;
        max-width: 100%;
        max-height: 60vh;
    }

    .crop-actions {
        margin-top: 20px;
        display: flex;
        gap: 20px;
    }
</style>

<div class="profile-container">
    <h2>個人資料</h2>

    <div class="avatar-section">
        <img src="{% if session.get('avatar') %}/api/profile/avatar/{{ session['avatar'] }}{% else %}{{ session.get('google_avatar') or url_for('static', filename='images/user.png') }}{% endif %}" 
             alt="avatar" 
             style="width:100px; height:100px; border-radius:50%; object-fit: cover; border: 3px solid #e2e8f0;" 
             id="avatar-img">
        
        <div class="user-info">
            <p style="font-size: 1.1em; font-weight: bold; margin-bottom: 5px;">{{ user.username }}</p>
            <div class="btn-group">
                <label for="avatar-input" class="btn" style="padding: 8px 16px; font-size: 0.9em;">更換頭像</label>
                <input type="file" id="avatar-input" accept="image/*" style="display:none;">
                <button id="delete-avatar" class="btn-danger" style="padding: 8px 16px; font-size: 0.9em;">刪除頭像</button>
            </div>
        </div>
    </div>

    <h3 class="profile-section-title">安全性設定</h3>
    
    <label for="old-password" style="font-size: 0.9em; color: #718096; margin-bottom: 5px; display:block;">舊密碼</label>
    <input type="password" id="old-password" class="profile-input" placeholder="請輸入舊密碼">
    
    <label for="new-password" style="font-size: 0.9em; color: #718096; margin-bottom: 5px; display:block;">新密碼</label>
    <input type="password" id="new-password" class="profile-input" placeholder="請輸入新密碼">
    
    <button id="change-password" style="width: 100%; margin-top: 10px;">確認修改密碼</button>
</div>

<div id="crop-modal">
    <div class="crop-container">
        <img id="image-to-crop" src="" alt="Picture">
    </div>
    <div class="crop-actions">
        <button id="crop-upload-btn" class="btn-success">確認裁切並上傳</button>
        <button id="crop-cancel-btn" class="btn-secondary">取消</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<script defer src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endblock %}